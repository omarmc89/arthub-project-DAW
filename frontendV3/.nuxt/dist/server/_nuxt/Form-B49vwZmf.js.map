{"version":3,"file":"Form-B49vwZmf.js","sources":["../../../../node_modules/@nuxt/ui/dist/runtime/components/forms/Form.vue"],"sourcesContent":["<template>\n  <form @submit.prevent=\"onSubmit\">\n    <slot />\n  </form>\n</template>\n\n<script>\nimport { provide, ref, defineComponent, onUnmounted, onMounted } from \"vue\";\nimport { useEventBus } from \"@vueuse/core\";\nimport { useId } from \"#imports\";\nclass FormException extends Error {\n  constructor(message) {\n    super(message);\n    this.message = message;\n    Object.setPrototypeOf(this, FormException.prototype);\n  }\n}\nexport default defineComponent({\n  props: {\n    schema: {\n      type: Object,\n      default: void 0\n    },\n    state: {\n      type: Object,\n      required: true\n    },\n    validate: {\n      type: Function,\n      default: () => []\n    },\n    validateOn: {\n      type: Array,\n      default: () => [\"blur\", \"input\", \"change\", \"submit\"]\n    }\n  },\n  emits: [\"submit\", \"error\"],\n  setup(props, { expose, emit }) {\n    const formId = useId();\n    const bus = useEventBus(`form-${formId}`);\n    onMounted(() => {\n      bus.on(async (event) => {\n        if (event.type !== \"submit\" && props.validateOn?.includes(event.type)) {\n          await validate(event.path, { silent: true });\n        }\n      });\n    });\n    onUnmounted(() => {\n      bus.reset();\n    });\n    const errors = ref([]);\n    provide(\"form-errors\", errors);\n    provide(\"form-events\", bus);\n    const inputs = ref({});\n    provide(\"form-inputs\", inputs);\n    async function getErrors() {\n      let errs = await props.validate(props.state);\n      if (props.schema) {\n        if (isZodSchema(props.schema)) {\n          errs = errs.concat(await getZodErrors(props.state, props.schema));\n        } else if (isYupSchema(props.schema)) {\n          errs = errs.concat(await getYupErrors(props.state, props.schema));\n        } else if (isJoiSchema(props.schema)) {\n          errs = errs.concat(await getJoiErrors(props.state, props.schema));\n        } else if (isValibotSchema(props.schema)) {\n          errs = errs.concat(await getValibotError(props.state, props.schema));\n        } else {\n          throw new Error(\"Form validation failed: Unsupported form schema\");\n        }\n      }\n      return errs;\n    }\n    async function validate(path, opts = { silent: false }) {\n      let paths = path;\n      if (path && !Array.isArray(path)) {\n        paths = [path];\n      }\n      if (paths) {\n        const otherErrors = errors.value.filter(\n          (error) => !paths.includes(error.path)\n        );\n        const pathErrors = (await getErrors()).filter(\n          (error) => paths.includes(error.path)\n        );\n        errors.value = otherErrors.concat(pathErrors);\n      } else {\n        errors.value = await getErrors();\n      }\n      if (errors.value.length > 0) {\n        if (opts.silent)\n          return false;\n        throw new FormException(\n          `Form validation failed: ${JSON.stringify(errors.value, null, 2)}`\n        );\n      }\n      return props.state;\n    }\n    async function onSubmit(payload) {\n      const event = payload;\n      try {\n        if (props.validateOn?.includes(\"submit\")) {\n          await validate();\n        }\n        const submitEvent = {\n          ...event,\n          data: props.state\n        };\n        emit(\"submit\", submitEvent);\n      } catch (error) {\n        if (!(error instanceof FormException)) {\n          throw error;\n        }\n        const errorEvent = {\n          ...event,\n          errors: errors.value.map((err) => ({\n            ...err,\n            id: inputs.value[err.path]\n          }))\n        };\n        emit(\"error\", errorEvent);\n      }\n    }\n    expose({\n      validate,\n      errors,\n      setErrors(errs, path) {\n        errors.value = errs;\n        if (path) {\n          errors.value = errors.value.filter(\n            (error) => error.path !== path\n          ).concat(errs);\n        } else {\n          errors.value = errs;\n        }\n      },\n      async submit() {\n        await onSubmit(new Event(\"submit\"));\n      },\n      getErrors(path) {\n        if (path) {\n          return errors.value.filter((err) => err.path === path);\n        }\n        return errors.value;\n      },\n      clear(path) {\n        if (path) {\n          errors.value = errors.value.filter((err) => err.path !== path);\n        } else {\n          errors.value = [];\n        }\n      }\n    });\n    return {\n      onSubmit\n    };\n  }\n});\nfunction isYupSchema(schema) {\n  return schema.validate && schema.__isYupSchema__;\n}\nfunction isYupError(error) {\n  return error.inner !== void 0;\n}\nasync function getYupErrors(state, schema) {\n  try {\n    await schema.validate(state, { abortEarly: false });\n    return [];\n  } catch (error) {\n    if (isYupError(error)) {\n      return error.inner.map((issue) => ({\n        path: issue.path ?? \"\",\n        message: issue.message\n      }));\n    } else {\n      throw error;\n    }\n  }\n}\nfunction isZodSchema(schema) {\n  return schema.parse !== void 0;\n}\nasync function getZodErrors(state, schema) {\n  const result = await schema.safeParseAsync(state);\n  if (result.success === false) {\n    return result.error.issues.map((issue) => ({\n      path: issue.path.join(\".\"),\n      message: issue.message\n    }));\n  }\n  return [];\n}\nfunction isJoiSchema(schema) {\n  return schema.validateAsync !== void 0 && schema.id !== void 0;\n}\nfunction isJoiError(error) {\n  return error.isJoi === true;\n}\nasync function getJoiErrors(state, schema) {\n  try {\n    await schema.validateAsync(state, { abortEarly: false });\n    return [];\n  } catch (error) {\n    if (isJoiError(error)) {\n      return error.details.map((detail) => ({\n        path: detail.path.join(\".\"),\n        message: detail.message\n      }));\n    } else {\n      throw error;\n    }\n  }\n}\nfunction isValibotSchema(schema) {\n  return schema._parse !== void 0;\n}\nasync function getValibotError(state, schema) {\n  const result = await schema._parse(state);\n  if (result.issues) {\n    return result.issues.map((issue) => ({\n      path: issue.path?.map((p) => p.key).join(\".\") || \"\",\n      message: issue.message\n    }));\n  }\n  return [];\n}\n</script>\n"],"names":["_ssrRenderAttrs","_ssrRenderSlot"],"mappings":"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","x_google_ignoreList":[0]}