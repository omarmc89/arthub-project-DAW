{"version":3,"file":"CubQx0wi.js","sources":["../../../../node_modules/@nuxt/ui/dist/runtime/components/forms/Form.vue"],"sourcesContent":["<template>\n  <form @submit.prevent=\"onSubmit\">\n    <slot />\n  </form>\n</template>\n\n<script>\nimport { provide, ref, defineComponent, onUnmounted, onMounted } from \"vue\";\nimport { useEventBus } from \"@vueuse/core\";\nimport { useId } from \"#imports\";\nclass FormException extends Error {\n  constructor(message) {\n    super(message);\n    this.message = message;\n    Object.setPrototypeOf(this, FormException.prototype);\n  }\n}\nexport default defineComponent({\n  props: {\n    schema: {\n      type: Object,\n      default: void 0\n    },\n    state: {\n      type: Object,\n      required: true\n    },\n    validate: {\n      type: Function,\n      default: () => []\n    },\n    validateOn: {\n      type: Array,\n      default: () => [\"blur\", \"input\", \"change\", \"submit\"]\n    }\n  },\n  emits: [\"submit\", \"error\"],\n  setup(props, { expose, emit }) {\n    const formId = useId();\n    const bus = useEventBus(`form-${formId}`);\n    onMounted(() => {\n      bus.on(async (event) => {\n        if (event.type !== \"submit\" && props.validateOn?.includes(event.type)) {\n          await validate(event.path, { silent: true });\n        }\n      });\n    });\n    onUnmounted(() => {\n      bus.reset();\n    });\n    const errors = ref([]);\n    provide(\"form-errors\", errors);\n    provide(\"form-events\", bus);\n    const inputs = ref({});\n    provide(\"form-inputs\", inputs);\n    async function getErrors() {\n      let errs = await props.validate(props.state);\n      if (props.schema) {\n        if (isZodSchema(props.schema)) {\n          errs = errs.concat(await getZodErrors(props.state, props.schema));\n        } else if (isYupSchema(props.schema)) {\n          errs = errs.concat(await getYupErrors(props.state, props.schema));\n        } else if (isJoiSchema(props.schema)) {\n          errs = errs.concat(await getJoiErrors(props.state, props.schema));\n        } else if (isValibotSchema(props.schema)) {\n          errs = errs.concat(await getValibotError(props.state, props.schema));\n        } else {\n          throw new Error(\"Form validation failed: Unsupported form schema\");\n        }\n      }\n      return errs;\n    }\n    async function validate(path, opts = { silent: false }) {\n      let paths = path;\n      if (path && !Array.isArray(path)) {\n        paths = [path];\n      }\n      if (paths) {\n        const otherErrors = errors.value.filter(\n          (error) => !paths.includes(error.path)\n        );\n        const pathErrors = (await getErrors()).filter(\n          (error) => paths.includes(error.path)\n        );\n        errors.value = otherErrors.concat(pathErrors);\n      } else {\n        errors.value = await getErrors();\n      }\n      if (errors.value.length > 0) {\n        if (opts.silent)\n          return false;\n        throw new FormException(\n          `Form validation failed: ${JSON.stringify(errors.value, null, 2)}`\n        );\n      }\n      return props.state;\n    }\n    async function onSubmit(payload) {\n      const event = payload;\n      try {\n        if (props.validateOn?.includes(\"submit\")) {\n          await validate();\n        }\n        const submitEvent = {\n          ...event,\n          data: props.state\n        };\n        emit(\"submit\", submitEvent);\n      } catch (error) {\n        if (!(error instanceof FormException)) {\n          throw error;\n        }\n        const errorEvent = {\n          ...event,\n          errors: errors.value.map((err) => ({\n            ...err,\n            id: inputs.value[err.path]\n          }))\n        };\n        emit(\"error\", errorEvent);\n      }\n    }\n    expose({\n      validate,\n      errors,\n      setErrors(errs, path) {\n        errors.value = errs;\n        if (path) {\n          errors.value = errors.value.filter(\n            (error) => error.path !== path\n          ).concat(errs);\n        } else {\n          errors.value = errs;\n        }\n      },\n      async submit() {\n        await onSubmit(new Event(\"submit\"));\n      },\n      getErrors(path) {\n        if (path) {\n          return errors.value.filter((err) => err.path === path);\n        }\n        return errors.value;\n      },\n      clear(path) {\n        if (path) {\n          errors.value = errors.value.filter((err) => err.path !== path);\n        } else {\n          errors.value = [];\n        }\n      }\n    });\n    return {\n      onSubmit\n    };\n  }\n});\nfunction isYupSchema(schema) {\n  return schema.validate && schema.__isYupSchema__;\n}\nfunction isYupError(error) {\n  return error.inner !== void 0;\n}\nasync function getYupErrors(state, schema) {\n  try {\n    await schema.validate(state, { abortEarly: false });\n    return [];\n  } catch (error) {\n    if (isYupError(error)) {\n      return error.inner.map((issue) => ({\n        path: issue.path ?? \"\",\n        message: issue.message\n      }));\n    } else {\n      throw error;\n    }\n  }\n}\nfunction isZodSchema(schema) {\n  return schema.parse !== void 0;\n}\nasync function getZodErrors(state, schema) {\n  const result = await schema.safeParseAsync(state);\n  if (result.success === false) {\n    return result.error.issues.map((issue) => ({\n      path: issue.path.join(\".\"),\n      message: issue.message\n    }));\n  }\n  return [];\n}\nfunction isJoiSchema(schema) {\n  return schema.validateAsync !== void 0 && schema.id !== void 0;\n}\nfunction isJoiError(error) {\n  return error.isJoi === true;\n}\nasync function getJoiErrors(state, schema) {\n  try {\n    await schema.validateAsync(state, { abortEarly: false });\n    return [];\n  } catch (error) {\n    if (isJoiError(error)) {\n      return error.details.map((detail) => ({\n        path: detail.path.join(\".\"),\n        message: detail.message\n      }));\n    } else {\n      throw error;\n    }\n  }\n}\nfunction isValibotSchema(schema) {\n  return schema._parse !== void 0;\n}\nasync function getValibotError(state, schema) {\n  const result = await schema._parse(state);\n  if (result.issues) {\n    return result.issues.map((issue) => ({\n      path: issue.path?.map((p) => p.key).join(\".\") || \"\",\n      message: issue.message\n    }));\n  }\n  return [];\n}\n</script>\n"],"names":["FormException","message","_sfc_main","defineComponent","props","expose","emit","formId","useId","bus","useEventBus","onMounted","event","_a","validate","onUnmounted","errors","ref","provide","inputs","getErrors","errs","isZodSchema","getZodErrors","isYupSchema","getYupErrors","isJoiSchema","getJoiErrors","isValibotSchema","getValibotError","path","opts","paths","otherErrors","error","pathErrors","onSubmit","payload","submitEvent","errorEvent","err","schema","isYupError","state","issue","result","isJoiError","detail","p","_createElementBlock","_cache","_withModifiers","_ctx","args","_renderSlot"],"mappings":"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","x_google_ignoreList":[0]}