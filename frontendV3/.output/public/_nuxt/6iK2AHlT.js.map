{"version":3,"file":"6iK2AHlT.js","sources":["../../../../store/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\n\n// interface UserPayloadInterface {\n//     email: string\n//     password: string\n// }\n\nexport const useAuthStore = defineStore('auth', {\n    state: () => ({\n        authenticated: false,\n        loading: false,\n        userEmailLogged: '',\n        userLogged : '',\n        sessionToken : '',\n        artistId: ''\n    }),\n\n    actions: {\n        async authenticateUser({ email, password }) {\n            const { data, error, pending } = await useFetch('https://arthub-api-polished-breeze-902.fly.dev/api/v1/auth/login/', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    email,\n                    password,\n                }),\n            })\n\n            this.loading = pending\n\n            if (data.value) {\n                const token = useCookie('token')\n                token.value = data.value.key\n                this.authenticated = true\n                this.userEmailLogged = email\n                this.sessionToken = data.value.key\n                localStorage.setItem('token', data.value.key)\n            }\n            this.getUserID()\n\n            return { data: data.value, error: error.value }\n        },\n    \n        async getUserID() {\n            const { data } = await useFetch ('https://arthub-api-polished-breeze-902.fly.dev/api/v1/auth/user/', {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Token ${localStorage.getItem('token')}`\n            }\n        })\n\n            if (data.value) {\n                const userLogin = {...data.value}\n                this.userLogged = userLogin\n                localStorage.setItem('userId', data.value.pk)\n                this.getArtistId()\n            }\n        },\n        \n        async getArtistId() {\n            const { data } = await useFetch (`https://arthub-api-polished-breeze-902.fly.dev/api/v1/search/artist/?user_id=${this.userLogged.pk}`, {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Token ${localStorage.getItem('token')}`\n            }\n        })\n\n            if (data.value) {\n                const artistData = data.value\n                this.artistId = artistData.id\n                localStorage.setItem('artistID', data.value.id)\n            }\n        },\n\n        logout() {\n            const token = useCookie('token')\n            this.authenticated = false\n            token.value = null\n            this.userEmailLogged = null\n            this.userLogged = null\n            this.sessionToken = null\n            this.artistId = null\n            localStorage.removeItem('token')\n            localStorage.removeItem('userId')\n        }\n    },\n    persist: true,\n})"],"names":["useAuthStore","defineStore","email","password","data","error","pending","useFetch","token","useCookie","userLogin","artistData"],"mappings":"6EAOY,MAACA,EAAeC,EAAY,OAAQ,CAC5C,MAAO,KAAO,CACV,cAAe,GACf,QAAS,GACT,gBAAiB,GACjB,WAAa,GACb,aAAe,GACf,SAAU,EAClB,GAEI,QAAS,CACL,MAAM,iBAAiB,CAAE,MAAAC,EAAO,SAAAC,GAAY,CACxC,KAAM,CAAE,KAAAC,EAAM,MAAAC,EAAO,QAAAC,CAAO,EAAK,MAAMC,EAAS,oEAAqE,CACjH,OAAQ,OACR,QAAS,CACL,eAAgB,kBACnB,EACD,KAAM,KAAK,UAAU,CACjB,MAAAL,EACA,SAAAC,CACpB,CAAiB,CACL,EAAA,aAAC,EAID,GAFA,KAAK,QAAUG,EAEXF,EAAK,MAAO,CACZ,MAAMI,EAAQC,EAAU,OAAO,EAC/BD,EAAM,MAAQJ,EAAK,MAAM,IACzB,KAAK,cAAgB,GACrB,KAAK,gBAAkBF,EACvB,KAAK,aAAeE,EAAK,MAAM,IAC/B,aAAa,QAAQ,QAASA,EAAK,MAAM,GAAG,CAC/C,CACD,YAAK,UAAW,EAET,CAAE,KAAMA,EAAK,MAAO,MAAOC,EAAM,KAAO,CAClD,EAED,MAAM,WAAY,CACd,KAAM,CAAE,KAAAD,CAAI,EAAK,MAAMG,EAAU,mEAAoE,CACjG,OAAQ,MACR,QAAS,CACL,eAAgB,mBAChB,cAAiB,SAAS,aAAa,QAAQ,OAAO,CAAC,EAC9D,gBACJ,EAEG,GAAIH,EAAK,MAAO,CACZ,MAAMM,EAAY,CAAC,GAAGN,EAAK,KAAK,EAChC,KAAK,WAAaM,EAClB,aAAa,QAAQ,SAAUN,EAAK,MAAM,EAAE,EAC5C,KAAK,YAAa,CACrB,CACJ,EAED,MAAM,aAAc,CAChB,KAAM,CAAE,KAAAA,GAAS,MAAMG,EAAU,gFAAgF,KAAK,WAAW,EAAE,GAAI,CACnI,OAAQ,MACR,QAAS,CACL,eAAgB,mBAChB,cAAiB,SAAS,aAAa,QAAQ,OAAO,CAAC,EAC9D,gBACJ,EAEG,GAAIH,EAAK,MAAO,CACZ,MAAMO,EAAaP,EAAK,MACxB,KAAK,SAAWO,EAAW,GAC3B,aAAa,QAAQ,WAAYP,EAAK,MAAM,EAAE,CACjD,CACJ,EAED,QAAS,CACL,MAAMI,EAAQC,EAAU,OAAO,EAC/B,KAAK,cAAgB,GACrBD,EAAM,MAAQ,KACd,KAAK,gBAAkB,KACvB,KAAK,WAAa,KAClB,KAAK,aAAe,KACpB,KAAK,SAAW,KAChB,aAAa,WAAW,OAAO,EAC/B,aAAa,WAAW,QAAQ,CACnC,CACJ,EACD,QAAS,EACb,CAAC"}