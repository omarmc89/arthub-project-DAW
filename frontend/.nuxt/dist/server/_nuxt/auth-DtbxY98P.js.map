{"version":3,"file":"auth-DtbxY98P.js","sources":["../../../../store/auth.js"],"sourcesContent":["import { defineStore } from 'pinia'\n\n// interface UserPayloadInterface {\n//     email: string\n//     password: string\n// }\n\nexport const useAuthStore = defineStore('auth', {\n    state: () => ({\n        authenticated: false,\n        loading: false,\n        userEmailLogged: '',\n        userLogged : '',\n        sessionToken : '',\n        artistId: ''\n    }),\n\n    actions: {\n        async authenticateUser({ email, password }) {\n            const { data, error, pending } = await useFetch('https://arthub-api-polished-breeze-902.fly.dev/api/v1/auth/login/', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    email,\n                    password,\n                }),\n            })\n\n            this.loading = pending\n\n            if (data.value) {\n                const token = useCookie('token')\n                token.value = data.value.key\n                this.authenticated = true\n                this.userEmailLogged = email\n                this.sessionToken = data.value.key\n                localStorage.setItem('token', data.value.key)\n            }\n            this.getUserID()\n\n            return { data: data.value, error: error.value }\n        },\n    \n        async getUserID() {\n            const { data } = await useFetch ('https://arthub-api-polished-breeze-902.fly.dev/api/v1/auth/user/', {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Token ${localStorage.getItem('token')}`\n            }\n        })\n\n            if (data.value) {\n                const userLogin = {...data.value}\n                this.userLogged = userLogin\n                localStorage.setItem('userId', data.value.pk)\n                this.getArtistId()\n            }\n        },\n        \n        async getArtistId() {\n            const { data } = await useFetch (`https://arthub-api-polished-breeze-902.fly.dev/api/v1/search/artist/?user_id=${this.userLogged.pk}`, {\n                method: 'GET',\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Authorization': `Token ${localStorage.getItem('token')}`\n            }\n        })\n\n            if (data.value) {\n                const artistData = data.value\n                this.artistId = artistData.id\n                localStorage.setItem('artistID', data.value.id)\n            }\n        },\n\n        logout() {\n            const token = useCookie('token')\n            this.authenticated = false\n            token.value = null\n            this.userEmailLogged = null\n            this.userLogged = null\n            this.sessionToken = null\n            this.artistId = null\n            localStorage.removeItem('token')\n            localStorage.removeItem('userId')\n        }\n    },\n    persist: true,\n})"],"names":[],"mappings":";;AAOY,MAAC,eAAe,YAAY,QAAQ;AAAA,EAC5C,OAAO,OAAO;AAAA,IACV,eAAe;AAAA,IACf,SAAS;AAAA,IACT,iBAAiB;AAAA,IACjB,YAAa;AAAA,IACb,cAAe;AAAA,IACf,UAAU;AAAA,EAClB;AAAA,EAEI,SAAS;AAAA,IACL,MAAM,iBAAiB,EAAE,OAAO,YAAY;AACxC,YAAM,EAAE,MAAM,OAAO,QAAO,IAAK,MAAM,SAAS,qEAAqE;AAAA,QACjH,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,gBAAgB;AAAA,QACnB;AAAA,QACD,MAAM,KAAK,UAAU;AAAA,UACjB;AAAA,UACA;AAAA,QACpB,CAAiB;AAAA,MACL,GAAA,aAAC;AAED,WAAK,UAAU;AAEf,UAAI,KAAK,OAAO;AACZ,cAAM,QAAQ,UAAU,OAAO;AAC/B,cAAM,QAAQ,KAAK,MAAM;AACzB,aAAK,gBAAgB;AACrB,aAAK,kBAAkB;AACvB,aAAK,eAAe,KAAK,MAAM;AAC/B,qBAAa,QAAQ,SAAS,KAAK,MAAM,GAAG;AAAA,MAC/C;AACD,WAAK,UAAW;AAEhB,aAAO,EAAE,MAAM,KAAK,OAAO,OAAO,MAAM,MAAO;AAAA,IAClD;AAAA,IAED,MAAM,YAAY;AACd,YAAM,EAAE,KAAI,IAAK,MAAM,SAAU,oEAAoE;AAAA,QACjG,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,gBAAgB;AAAA,UAChB,iBAAiB,SAAS,aAAa,QAAQ,OAAO,CAAC;AAAA,QAC9D;AAAA,sBACJ;AAEG,UAAI,KAAK,OAAO;AACZ,cAAM,YAAY,EAAC,GAAG,KAAK,MAAK;AAChC,aAAK,aAAa;AAClB,qBAAa,QAAQ,UAAU,KAAK,MAAM,EAAE;AAC5C,aAAK,YAAa;AAAA,MACrB;AAAA,IACJ;AAAA,IAED,MAAM,cAAc;AAChB,YAAM,EAAE,SAAS,MAAM,SAAU,gFAAgF,KAAK,WAAW,EAAE,IAAI;AAAA,QACnI,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,gBAAgB;AAAA,UAChB,iBAAiB,SAAS,aAAa,QAAQ,OAAO,CAAC;AAAA,QAC9D;AAAA,sBACJ;AAEG,UAAI,KAAK,OAAO;AACZ,cAAM,aAAa,KAAK;AACxB,aAAK,WAAW,WAAW;AAC3B,qBAAa,QAAQ,YAAY,KAAK,MAAM,EAAE;AAAA,MACjD;AAAA,IACJ;AAAA,IAED,SAAS;AACL,YAAM,QAAQ,UAAU,OAAO;AAC/B,WAAK,gBAAgB;AACrB,YAAM,QAAQ;AACd,WAAK,kBAAkB;AACvB,WAAK,aAAa;AAClB,WAAK,eAAe;AACpB,WAAK,WAAW;AAChB,mBAAa,WAAW,OAAO;AAC/B,mBAAa,WAAW,QAAQ;AAAA,IACnC;AAAA,EACJ;AAAA,EACD,SAAS;AACb,CAAC;"}